name: C (gcc self-hosted via MSYS2 UCRT64)

on:
  workflow_dispatch:

jobs:
  build-and-run:
    runs-on: self-hosted
    timeout-minutes: 10

    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 1
          lfs: false
          submodules: false

      - name: Verify gcc (UCRT64)
        shell: cmd
        run: |
          "C:\msys64\ucrt64.exe" -lc "gcc --version"

      - name: Compile (UCRT64)
        shell: cmd
        run: |
          "C:\msys64\ucrt64.exe" -lc "cd \"$GITHUB_WORKSPACE\" && gcc -Wall -Wextra -O2 hello_world.c -o hello_world.exe"

      - name: Run (UCRT64)
        shell: cmd
        run: |
          "C:\msys64\ucrt64.exe" -lc "cd \"$GITHUB_WORKSPACE\" && echo PWD: && pwd && echo FILES: && ls -la && echo RUN: && ./hello_world.exe && echo EXIT:$?"
