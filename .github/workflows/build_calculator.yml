name: Test calculator with report

on:
  workflow_dispatch:

jobs:
  test-and-report:
    runs-on: self-hosted
    timeout-minutes: 10

    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 1

      - name: Compile tests
        shell: cmd
        run: |
          cd /d "%GITHUB_WORKSPACE%"
          "C:\msys64\ucrt64\bin\gcc.exe" -Wall -Wextra -O2 calculator.c test_case.c -o test_case.exe
          dir

      - name: Run tests and creates report
        shell: cmd
        run: |
          cd /d "%GITHUB_WORKSPACE%"
          test_case.exe
          echo ExitCode=%ERRORLEVEL%
          dir
          type report.txt

      - name: Upload report artifact
        uses: actions/upload-artifact@v4
        with:
          name: test-report
          path: ${{ github.workspace }}\report.txt
